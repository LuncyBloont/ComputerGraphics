# 新的OpenGL (programmable architecture using shaders)
## 摘要
最新的OpenGL Core已经移除了固定渲染管线的内容，glBegin(...)...glEnd();的用法已经过时，最新的OpenGL程序一般使用shader、VAO和VBO等对象让GPU使用顶点数据和着色器绘图。<br>
参考 <br>
[Tutorial2: VAOs, VBOs, Vertex and Fragment Shaders (C / SDL)](https://www.khronos.org/opengl/wiki/Tutorial2:_VAOs,_VBOs,_Vertex_and_Fragment_Shaders_(C_/_SDL)) <br>
[Vertex Specification](https://www.khronos.org/opengl/wiki/Vertex_Specification)

## 着色器创建
常用着色器有：顶点着色器、网格细分着色器、片元着色器 <br>
除了渲染管线上第一个着色器的输入和最后一个着色器的输出，使用in、out关键字在着色器间的数据传递也可以辅助着色器的输入输出传递更多的信息。比如法线信息在顶点着色器上计算后利用out关键字（声明着色器输出）插值到片元着色器，片元着色器利用in关键字（声明着色器输入）获得插值的顶点法线后规格化就可以得到片元的法线信息。
### 顶点着色器
传入数据主要来自客户端（即VBO）缓存的顶点数据。服务端将顶点数据按一定的顺序和格式分配给顶点着色器（详见后文VAO和VBO）。一般情况下，输入数据中包括顶点位置，其次可能有纹理UV坐标和顶点法向信息等。 <br>
顶点着色器可输出gl_Position、gl_PointSize等信息，详见reference card。通常情况下都会输出gl_Position，即裁剪空间下的位置，可以理解为待插值的绘制坐标，该坐标为齐次坐标，即其具有xyzw四个分量，一般通过透视矩阵左乘传入的顶点位置得到，透视矩阵的推导详见数学相关的笔记。 <br>
平行投影变换为线性变换，即在屏幕上三角形内任意一点的深度、UV等属性是用其重心坐标在三个顶点间的线性插值。而透视变换为非线性变换，插值时不是简单的线性插值，需要透视矫正，详见数学相关笔记。 <br>
顶点着色器一般负责计算几何变换和模型修改（模型的修改也由网格细分着色器负责的）。
### 片元着色器
传入包括顶点位置（裁剪空间下）在内的各种信息，均由顶点着色器插值得到。 <br>
一般输出片元的颜色，片元和像素不能直接等同（像素是物理硬件上的），但在通常情况下片元颜色可以理解为像素的颜色。 <br>
片元着色器一般负责计算光照，逐片元的光照计算负担比逐顶点的光照大，但是效果也比逐顶点的光照优秀很多，使用现代的硬件设备通常不考虑在顶点上完成大多数光照。光照的具体计算详见光照模型部分。
### Uniform
传入着色器的信息除了传入顶点着色器的顶点信息外（包括由顶点信息间接计算传递到其他着色器的信息），还有uniform数据，由客户端绑定，任何阶段的着色器都可以通过uniform关键字声明获取。uniform数据和顶点数据的主要区别是，顶点数据是每个顶点都有一份的数据，描述每个顶点的信息；uniform数据是由客户端绑定，所有顶点公用的数据，简单理解为一次渲染中的全局变量。

## 顶点数据传递和绘制

### VAO

### VBO

### 基元